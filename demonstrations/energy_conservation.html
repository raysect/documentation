

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Checking Energy Conservation &mdash; Raysect Documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/RaysectLogo_web.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Raysect Documentation" href="../index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Raysect
          

          
            
            <img src="../_static/RaysectLogo_web.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.5.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">2. License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">3. Downloading and Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how_it_works.html">4. How it works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart_guide.html">5. Quickstart Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../observers.html">6. Sampling and Observers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../primitives.html">7. Primitives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../materials.html">8. Materials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conventions.html">9. Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">10. References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">11. Glossary</a></li>
</ul>
<p class="caption"><span class="caption-text">Demonstrations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="demonstrations.html">1. Core Functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="demonstrations.html#materials">2. Materials</a></li>
<li class="toctree-l1"><a class="reference internal" href="demonstrations.html#observers">3. Observers</a></li>
<li class="toctree-l1"><a class="reference internal" href="demonstrations.html#examples-gallery">4. Examples Gallery</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/core/core.html">1. Raysect Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/primitives/primitives.html">2. Primitives Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/optical/optical.html">3. Optical Module</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Raysect</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Checking Energy Conservation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/demonstrations/energy_conservation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="checking-energy-conservation">
<span id="demo-energy-conservation"></span><h1>Checking Energy Conservation<a class="headerlink" href="#checking-energy-conservation" title="Permalink to this headline">¶</a></h1>
<p>Its important that ray-tracers conserve energy. This demonstration gives an example case where we prove
that the total power collected on the boundary equals to total power radiated from a simple emitting source.
The principle can be extended to test cases with more complicated emission sources and boundaries.</p>
<p>As usual, we start by importing everything we need.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">pi</span>
<span class="kn">from</span> <span class="nn">raysect.core</span> <span class="k">import</span> <span class="n">translate</span><span class="p">,</span> <span class="n">rotate</span>
<span class="kn">from</span> <span class="nn">raysect.primitive</span> <span class="k">import</span> <span class="n">Sphere</span>
<span class="kn">from</span> <span class="nn">raysect.optical</span> <span class="k">import</span> <span class="n">World</span><span class="p">,</span> <span class="n">ConstantSF</span>
<span class="kn">from</span> <span class="nn">raysect.optical.observer</span> <span class="k">import</span> <span class="n">Pixel</span><span class="p">,</span> <span class="n">PowerPipeline0D</span>
<span class="kn">from</span> <span class="nn">raysect.optical.material.emitter</span> <span class="k">import</span> <span class="n">UnityVolumeEmitter</span><span class="p">,</span> <span class="n">UniformSurfaceEmitter</span>
</pre></div>
</div>
<p>The emitting source will be a sphere at the origin, surrounded by an observing box. The number of samples
requested will be relatively large so we can ensure good accuracy in the calculations. Note that this calculation
isn’t spectrally resolved so we only need a narrow spectral range with a single wavelength bin. Initialise the
constants and place the sphere in the scene.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">samples</span> <span class="o">=</span> <span class="mi">100000</span>

<span class="n">sphere_radius</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">cube_size</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">min_wl</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">max_wl</span> <span class="o">=</span> <span class="mi">401</span>

<span class="c1"># set-up scenegraph</span>
<span class="n">world</span> <span class="o">=</span> <span class="n">World</span><span class="p">()</span>
<span class="n">emitter</span> <span class="o">=</span> <span class="n">Sphere</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="n">sphere_radius</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">world</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that due to symmetry we don’t need to observe each face of the cube. We only need to observe 1 side and
multiply by 6. You could also model it with 6 individual pixel faces.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">power</span> <span class="o">=</span> <span class="n">PowerPipeline0D</span><span class="p">(</span><span class="n">accumulate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">observing_plane</span> <span class="o">=</span> <span class="n">Pixel</span><span class="p">([</span><span class="n">power</span><span class="p">],</span> <span class="n">x_width</span><span class="o">=</span><span class="n">cube_size</span><span class="p">,</span> <span class="n">y_width</span><span class="o">=</span><span class="n">cube_size</span><span class="p">,</span>
                        <span class="n">min_wavelength</span><span class="o">=</span><span class="n">min_wl</span><span class="p">,</span> <span class="n">max_wavelength</span><span class="o">=</span><span class="n">max_wl</span><span class="p">,</span>
                        <span class="n">spectral_bins</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pixel_samples</span><span class="o">=</span><span class="n">samples</span><span class="p">,</span>
                        <span class="n">parent</span><span class="o">=</span><span class="n">world</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">rotate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">translate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">cube_size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<p>First, let’s consider the case where the sphere is a uniform volume emitter with emission of 1W/m^3/str/nm).
The theoretical total emitted power would be given by 1W x the volume of the sphere x 4Pi steradians x
the wavelength range sampled. Lets implement the calculation and compare it to the measured value.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting observations with volume emitter...&quot;</span><span class="p">)</span>
<span class="n">calculated_volume_emission</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sphere_radius</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_wl</span> <span class="o">-</span> <span class="n">min_wl</span><span class="p">)</span>

<span class="n">emitter</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="n">UnityVolumeEmitter</span><span class="p">()</span>
<span class="n">observing_plane</span><span class="o">.</span><span class="n">observe</span><span class="p">()</span>
<span class="n">measured_volume_emission</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">power</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mean</span>
<span class="n">measured_volume_error</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">power</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">error</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Expected volume emission =&gt; </span><span class="si">{}</span><span class="s1"> W&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">calculated_volume_emission</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Measured volume emission =&gt; </span><span class="si">{}</span><span class="s1"> +/- </span><span class="si">{}</span><span class="s1"> W&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">measured_volume_emission</span><span class="p">,</span> <span class="n">measured_volume_error</span><span class="p">))</span>
</pre></div>
</div>
<p>For our test case, expected volume emission =&gt; 6.57 W, measured volume emission =&gt; 6.623 +/- 0.057 W.</p>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014-2018, Dr Alex Meakins.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.5.4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>